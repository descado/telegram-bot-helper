# Домашнее задание по теме "Observability (o11y)"

## Описание проекта

Данный проект представляет собой полноценный o11y-стек для микросервиса **"Telegram Bot Analytics & Logger"**.

Сервис предоставляет API, куда любой Telegram-бот может отправлять информацию о полученных сообщениях. Эта информация сохраняется в базе данных и может быть в дальнейшем использована для анализа.

Проект полностью развернут в облаке Yandex.Cloud с использованием Docker и Docker Compose. Вся конфигурация мониторинга (дашборды, алерты) описана в коде (Infrastructure as Code).

## Стек технологий

*   **Сервис:** Node.js, TypeScript, Express.js
*   **База данных:** MongoDB
*   **Мониторинг и сбор метрик:** Prometheus, prom-client, mongodb-exporter
*   **Визуализация:** Grafana
*   **Алертинг:** Alertmanager, Telegram
*   **Нагрузочное тестирование:** Locust
*   **Трейсинг:** Jaeger, OpenTelemetry
*   **Оркестрация:** Docker, Docker Compose
*   **Облачная платформа:** Yandex.Cloud

---

## Важные ссылки

*   **Дашборд Grafana:** [http://51.250.78.138:3000/](http://51.250.78.138:3000/)
    *   **Логин:** `admin`
    *   **Пароль:** `admin`

*   **UI для нагрузочного тестирования (Locust):** [http://51.250.78.138:8089/](http://51.250.78.138:8089/)

*   **UI для просмотра трейсов (Jaeger):** [http://51.250.78.138:16686/](http://51.250.78.138:16686/)

*   **Интерактивная документация по API (Swagger):** [http://51.250.78.138:8080/docs](http://51.250.78.138:8080/docs)

*   **Публичный Telegram-канал для алертов:** [Вставьте сюда вашу ссылку на Telegram-канал]

---

## Инструкция по воспроизведению алертов

Для демонстрации работы системы алертинга, пожалуйста, используйте UI для нагрузочного тестирования Locust.

### 1. Алерт по высокой задержке (p99 Latency > 500ms)

Этот алерт срабатывает, когда время ответа на одну из "бизнес-ручек" превышает 500 миллисекунд.

**Как воспроизвести:**
1.  Перейдите в **Locust UI** по ссылке выше.
2.  Запустите тест со следующими параметрами:
    *   **Number of users:** `20`
    *   **Spawn rate:** `5`
3.  Нагрузка будет идти на разные ручки, включая "медленную" `/api/search`. Из-за конкурентных запросов к базе данных без индекса, время ответа для нее начнет расти.
4.  В течение 1-2 минут на дашборде Grafana вы увидите рост p99 Latency, а в Telegram-канал придет соответствующее уведомление.

### 2. Алерт по высокой нагрузке на БД (RPS > 100)

Этот алерт срабатывает, когда общее количество операций в секунду в MongoDB превышает 100.

**Как воспроизвести:**
1.  Перейдите в **Locust UI**.
2.  Запустите тест со следующими параметрами:
    *   **Number of users:** `200`
    *   **Spawn rate:** `50`
3.  Это создаст высокую нагрузку на запись в БД через ручку `/api/log`.
4.  В течение минуты на дашборде Grafana вы увидите, что RPS в БД превысил 100, и в Telegram-канал придет уведомление.

---

## Infrastructure as Code (IaC)

Вся конфигурация системы описана в коде и применяется автоматически при запуске.

*   **Конфигурация Prometheus и правила алертов** находятся в директории [`./prometheus/`](./prometheus/).
*   **Конфигурация Grafana (источник данных и дашборды)** находится в директории [`./grafana/provisioning/`](./grafana/provisioning/). Дашборды и алерты создаются автоматически при старте контейнера.

---

## Бонусные задания

*   **Swagger (№6):** Реализована интерактивная документация по API, доступная по [этой ссылке](http://51.250.78.138:8080/docs).
*   **Трейсинг (№7):** Настроен сквозной трейсинг с помощью OpenTelemetry и Jaeger. Посмотреть трейсы можно в [Jaeger UI](http://51.250.78.138:16686/).
*   **"Новая" БД (№9):** В качестве основной базы данных используется документо-ориентированная СУБД MongoDB.
*   **"Новый" язык (№10):** Сервис написан на TypeScript.